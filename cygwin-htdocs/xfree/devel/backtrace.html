<!DOCTYPE html>

<html lang="en">
<head>
    <title>Cygwin/X - Reporting X server crashes</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../cygx.css" />
    <link rel="icon" type="image/ico" href="../favicon.ico" />
</head>

<body>
    <!--#include virtual="../cygx-leftbar.html"-->
    <div id="main">
    <!--#include virtual="../cygx-header.html" -->
    <h1>Reporting X server crashes</h1>

    <p>Useful backtraces will help identify where and why the crash is
    occurring, which will help us fix the bug.</p>

    <h2>Manually producing a crash backtrace</h2>

    <p>To generate a useful backtrace, you will need debugging symbols for the X server.</p>

    <h3>Preparation</h3>
    <br/>
    <ul>
      <li>Install the <b>xorg-server-debuginfo</b> package (for debugging symbols)</li>
      <li>Install the <b>gdb</b> package (for <code>gdb</code>)</li>
      <li>Install the <b>sysvinit</b> package (for <code>pidof</code>)</li>
    </ul>

    <h3>Generating a backtrace when some specific action is making the X server crash (automatically)</h3>
    <br/>
    <ul>
     <li>Start XWin using your normal method</li>
     <li>Reproduce your crash</li>
     <li>A backtrace should be captured into /var/log/xwin/XWin.0.log</li>
    </ul>

    <h3>Generating a backtrace when some specific action is making the X server crash (manually)</h3>
    <br/>
    <ul>
     <li>Start XWin using your normal method</li>
     <li>In a non-X terminal window, run <code>gdb --pid=`pidof /usr/bin/XWin`</code>, to attach gdb to the running X server</li>
     <li>Type <code>c</code> at the <code>(gdb)</code> prompt, to resume running the X server</li>
     <li>Reproduce your crash</li>
     <li>Type <code>bt full</code> at the <code>(gdb)</code> prompt, to produce a backtrace</li>
    </ul>

    <h3>Generating a backtrace when the X server is crashing at startup</h3>
    <br/>
    <ul>
     <li>In a non-X terminal window, run <code>gdb --args /usr/bin/XWin -multiwindow</code>, to start the X server under gdb
     (If you have customized how you start XWin to add additional options, you should also add them here)</li>
     <li>Type <code>handle SIGSYS nostop</code> at the <code>(gdb)</code> prompt</li>
     <li>Type <code>r</code> at the <code>(gdb)</code> prompt, to start running the X server</li>
     <li>Your crash should occur</li>
     <li>Type <code>bt full</code> at the <code>(gdb)</code> prompt, to produce a backtrace</li>
    </ul>

    <h3>Generating a backtrace when the X server is crashing at startup (alternative approach using JIT debugging)</h3>
    <br/>
    <ul>
     <li>Set the error_start token in the CYGWIN environment variable to run gdb, e.g. <code>CYGWIN="error_start=C:\cygwin\bin\gdb"</code>
         (If you are going to start the X server using a Windows shortcut, you will have to set this in the System applet of the Windows control panel)</li>
     <li>Start XWin using your normal method</li>
     <li>Your crash should occur</li>
     <li>Type <code>bt full</code> at the <code>(gdb)</code> prompt, to produce a backtrace</li>
    </ul>

    <p>Please attach the output from gdb, in addition to your <code>/var/log/xwin/XWin.0.log</code>, to your problem report.</p>

    <h3>Cleaning up</h3>
    <br/>
    <ul>
      <li>Uninstall the <b>xorg-server-debuginfo</b> package</li>
      <li>Uninstall the <b>gdb</b> and <b>sysvinit</b> packages if you no longer need them</li>
      <li>Restore the previous value of the CYGWIN environment variable, if you changed it</li>
    </ul>

    <h3>Preparation (alternative approach)</h3>
    <br/>
    <p>Alternatively, X server snapshots are built with debugging symbols included. You can install an X server snapshot with the following steps:</p>
    <ul>
      <li>
        Download the latest X Server snapshot from <a href="ftp://cygwin.com/pub/cygwinx/">ftp://cygwin.com/pub/cygwinx</a>
        <br/>
        <code>wget ftp://cygwin.com/pub/cygwinx/XWin.YYYMMDD-git-XXXXXXXXXXXXXXXX.exe.bz2</code>
      </li>
      <li>
        Uncompress it
        <br/>
        <code>bunzip2 XWin.YYYMMDD-git-XXXXXXXXXXXXXXXX.exe.bz2</code>
      </li>
      <li>
        Ensure it is executable
        <br/>
        <code>chmod +x XWin.YYYMMDD-git-XXXXXXXXXXXXXXXX.exe</code>
      </li>
      <li>
        Move it to /usr/bin
        <br/>
        <code>mv XWin.YYYMMDD-git-XXXXXXXXXXXXXXXX.exe /usr/bin/XWin.exe</code>
      </li>
    </ul>

    <p>To remove the X server snapshot, use setup to reinstall the <b>xorg-server</b> package</p>

    </div>
</body>
</html>
