<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>Cygwin Package Contributor's Guide</title>
  </head>

<body>
<!--#include virtual="navbar.html" -->
<div id="main">
<!--#include virtual="top.html" -->
<h1>Cygwin Package Contributor's Guide</h1>

<p>This document is intended for people who upload packages to sourceware.org,
  to be made available through the standard Cygwin setup program.
</p>

<h2 class="cartouche">Contents</h2>

<ul class="compact">
  <li><a href="#making_srcpackage">Making a package with cygport</a></li>
  <li><a href="#installing">Locally installing your package for testing</a></li>
  <li><a href="#test">Marking your package as a test version</a></li>
  <li><a href="#submitting">Submitting a package</a></li>
  <li><a href="#adopt">Updating or adopting an orphaned package</a></li>
  <li><a href="#acceptance">Uploading a package</a></li>
  <li><a href="#updating">Updating a package</a></li>
  <li><a href="#history">Historical packaging methods</a></li>
</ul>

<h2 class="cartouche" id="making_srcpackage">Making a package with cygport</h2>

<p>Suppose that the upstream's <code>boffo-1.0.tar.xz</code> source tar file, that you
downloaded from the boffo homepage, unpacks into <code>boffo-1.0/</code>.</p>

<p>Further, suppose you've got boffo ported to Cygwin. It took some work, but
you've got a patch file, which we will name <code>boffo-1.0-fix-whatever.patch</code>, and
with that applied <code>boffo</code> builds and runs.</p>

<p>All that remains is to write a <code>boffo.cygport</code> file which will
describe how to unpack, configure, build and package. See
these <a href="https://cygwin.github.io/cygport/autotools_cygclass.html">examples</a>
for a quick introduction to these files.
</p>

<pre class="sample-preformat">
# package name
NAME="boffo"
VERSION=1.0
RELEASE=1

# package metadata
CATEGORY="Games"
SUMMARY="A whackamole simulation in ASCII art"
DESCRIPTION="A whackamole simulation in ASCII art.
Intended for use on VT100 terminals at BAUD rates 1200 and
above.  Uses arrow keys for positioning over moles.  Space
bar whacks the mole.
No actual moles will be harmed during execution of this game."
HOMEPAGE="https://boffo.org"
LICENSE="BSD-3-Clause"

# source and patch files
SRC_URI="https://boffo.org/downloads/boffo-${VERSION}.tar.xz"
PATCH_URI="boffo-1.0-fix-whatever.patch"

# use the standard autotools src_compile, src_install and src_test
</pre>

<p>The source and binary packages can then be built and metadata .hint files generated by running <code>cygport</code>, e.g.</p>

<pre class="sample-preformat">
<b>$ cygport boffo.cygport download</b>
--2017-04-01 11:59:59--  https://boffo.org/downloads/boffo-1.0.tar.xz
Resolving boffo.org... 203.0.113.1
Connecting to boffo.org|203.0.113.1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 352 [application/x-tar]
Saving to: ‘boffo-1.0.tar.xz.tmp’

boffo-1.0.tar.xz.tmp 100%[===================>]     352  --.-KB/s    in 0s

2017-04-01 11:59:59 (8.06 MB/s) - ‘boffo-1.0.tar.xz.tmp’ saved [352/352]

<b>$ cygport boffo.cygport all</b>
>>> Preparing boffo-1.0-1.x86_64
>>> Unpacking source boffo-1.0.tar.xz
*** Info: applying patch boffo-1.0-fix-whatever.patch:
>>> Preparing working source directory
>>> Compiling boffo-1.0-1.x86_64
[...]
>>> Installing boffo-1.0-1.x86_64
[...]
Fixing symlinks:
Stripping executables:
        usr/bin/boffo.exe
Preparing debuginfo source files:
        1 files
>>> Packaging boffo-1.0-1.x86_64
>>> Creating binary package(s)
>>> boffo-1.0-1.tar.xz
usr/
usr/bin/
usr/bin/boffo.exe
usr/lib/
usr/share/
usr/share/doc/
usr/share/doc/boffo/
usr/share/doc/boffo/README

>>> boffo-debuginfo-1.0-1.tar.xz
usr/lib/debug/
usr/lib/debug/usr/
usr/lib/debug/usr/bin/
usr/lib/debug/usr/bin/boffo.exe.dbg
usr/src/debug/
usr/src/debug/boffo-1.0-1/
usr/src/debug/boffo-1.0-1/boffo.c

>>> Checking packages for missing or duplicate files

>>> Creating source patches
 0 files changed
>>> Creating source package
boffo-1.0-1.src/
boffo-1.0-1.src/boffo-1.0-fix-whatever.patch
boffo-1.0-1.src/boffo-1.0.tar.xz
boffo-1.0-1.src/boffo.cygport

>>> boffo requires: cygwin libncursesw10
</pre>

<p>For more information on using <code>cygport</code> consult the
<a href="https://cygwin.github.io/cygport/cygport.1.html">man page</a>,
<a href="https://github.com/cygwin/cygport/blob/master/README">README</a>,
<a href="https://cygwin.github.io/cygport/toc_index.html">reference manual</a>,
<a href="/packaging/cygport_tips.html">cygport tips</a> page
and sample .cygport files.</p>

<p>
  The cygport file for any existing cygwin package can be found in
  /usr/src/package_name after installing the source package, or in the
  <a href="https://cygwin.com/cgit/cygwin-packages/">packaging repositories<a>.
</p>

<h2 class="cartouche" id="installing">Locally installing your package for testing</h2>

<p>
Unfortunately, there is no tool for directly installing package files, at the
moment.  Two common techniques to achieve this:
</p>

<ul>
  <li>
    For simple packages you can fake installation by directly untarring the
    package file and then running any
    <a href="packaging-package-files.html#postinstall">postinstall scripts</a>
    manually:
    <pre>
      $ tar -C / -xvf boffo-1.0-1.x86_64/dist/boffo/boffo-1.0-1.tar.xz
      $ /etc/postinstall/boffo.sh</pre>
  </li>
  <li>
    For multiple packages with complex dependencies, you can use
    an <a href="package-server.html#overlay">overlay package server</a>.  Note
    that <code>setup</code> can accept paths and <code>file://</code> URLs so an
    FTP or HTTP server is not necessary.
  </li>
</ul>

<h2 class="cartouche" id="test">Marking your package as a test version</h2>

Packages can be marked as test versions, which are not offered for installation
by setup unless the use of test packages has been opted-into, by using
<code>cygport all-test</code>, rather than <code>cygport all</code>.

Building the packages in that way adds a
<a href="packaging-hint-files.html#pvr.hint"><code>test:</code></a> to the hint.

<h2 class="cartouche" id="submitting">Submitting a new package</h2>

<p>So you've got a package you want to submit. Follow the following checklist before emailing the <code>cygwin-apps</code> mailing list, and you'll almost certainly save time.</p>
<ul class="spaced">
  <li>
    <p><i>Do you have the time to maintain the package?</i></p>
    <p>
      Packages without an active maintainer may be pulled from the
      distribution. Generally speaking the time commitment is relatively low,
      simply subscribe to the <code>cygwin</code> mailing list. When
      a <i>bug</i> in your package is reported in the cygwin mailing list,
      address the bug (if it's a Cygwin-only bug) or pass back to the
      upstream. When a solution exists, create and upload an updated package
      with the fix in it. Note that you are not expected to be a helpdesk for
      the package - the users should be pointed upstream if you've determined
      that the bug is not a Cygwin-related bug.
    </p>
  </li>
  <li>
    <p>
      Propose on the <code>cygwin-apps</code> mailing list that you are interested
      in becoming a package maintainer for package "foo" using a subject like
      "[<a href="acronyms/#ITP">ITP</a>] foo 0.10".
    </p>
    Submission rules:<br />
    <ul class="compact">
      <li>If the new package is already included in a major Linux distribution
        (e.g. Debian, Fedora, SuSE) please mention that.</li>
      <li>If the package is not included in any major Linux distro it must receive <b>five positive votes</b> from other package maintainers in order to be accepted.</li>
      <li>Mention which <a href="https://opensource.org/licenses">open source license</a> applies to the source.</li>
      <li>
        We generally follow
        <a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/what-can-be-packaged/">
        Fedora guidelines</a> on what packages can be accepted, which excludes
        content which potentially infringes on patents or trademarks, or is
        illegal or offensive.
      </li>
    </ul>
  </li>
  <li>
    <p>
      Write good package metadata
    </p>
    <ul class="compact">
      <li>In order to select an appropriate a correct <code>category</code> you
      can look in e.g. the Debian package list and identify the section that
      your package is present in there - if it's available via Debian. If it's
      not, have a look and take a sensible
      guess. Use <a href="packaging-hint-files.html#categories">existing
      categories</a> if at all possible.</li>
      <li>Do not use the package name in <code>sdesc</code>, as it is added
      automatically by the <code>setup</code> program.</li>
    </ul>
  </li>
  <li>
    If the package has a test-suite, run <code>cygport test</code> and note the
    results: success, or failures you have determined are not significant.
  </li>
  <li>
    <p>
      If at all possible, build the package and place the package files on a
      publicly accessible HTTP/FTP site, and provide the URL in your mail.
    </p>
  </li>
  <li>There is no need to increase the release number if the package has not
    been officially released.  So, if you are releasing a -1 release of a
    package keep using -1 for any refinements <em>until</em> the package has
    been uploaded.</li>
  <li>Each new package must in any case receive one <a href="acronyms/#GTG">GTG</a> vote from a package maintainer, meaning that an existing maintainer has downloaded the package, inspected the tar file contents, tested the applications, and rebuilt the package from the source tar file without incident. Once a successful package is produced, you become a maintainer yourself and can provide GTG reviews for others as well.</li>

</ul>

<h2 class="cartouche" id="adopt">Updating or adopting an orphaned package</h2>

<p>
  Unfortunately <a href="/packages/reports/unmaintained.html">some packages</a>
  are without a maintainer, and volunteers to take over are welcome.
</p>

<ul class="spaced">
  <li>
    Find the appropriate source package in
    the <a href="/packages/src_package_list.html">source package list</a>.
  </li>
  <li>
    The package summary page should link to the packaging git repository,
    containing the <code>.cygport</code> and patch files.
    <code>git clone</code> that repository from the listed URL (for some older
    packages, this repository may not exist yet, in which case, install the
    source package using <code>setup</code> instead).
  </li>
  <li>
    Edit the <code>.cygport</code> file to adjust the version appropriately.
  </li>
  <li>
    <code>cygport <i>package</i>.cygport download all check</code>
  </li>
  <li>
    Hopefully it all <i>'just works'</i>, but maybe there are some problems to
    fix! (Consider looking at e.g. upstream bug reports and fixes, and patches
    applied in Linux distributions to avoid duplicating effort).
  </li>
  <li>
    <p>
    email the <code>cygwin-apps</code> mailing list, as
    in <a href="/packaging-contributors-guide.html#submitting">submitting a new
    package</a>, except use "[<a href="acronyms/#ITA">ITA</a>]" rather than
    "[<a href="acronyms/#ITP">ITP</a>]" in the subject.
    </p>
    <p>
    Even if you don't wish to become a maintainer, sharing your updated cygport
    with the <code>cygwin-apps</code> list, and a report of success or failure
    is helpful.
    </p>
  </li>
</ul>

<h2 class="cartouche" id="acceptance">Uploading a package</h2>

<ul class="spaced">
  <li>Once you have your GTG, follow the instructions for
    <a href="packaging/key.html">submitting a ssh key</a>.
  </li>
  <li>either
    <ul>
      <li>push to the <a href="packaging/repos.html">packaging git
          repository</a> with <code>'--push-option=deploy'</code>, which will
          cause packages to be <a href="packaging/build.html"> built and
          uploaded</a> for you.
      </li>
    </ul>
    <p>or</p>
    <ul>
  <li>
    <a href="package-upload.html">Upload your package files</a>.
  </li>
  <li>
    Please remember to build and upload packages for all architectures (only
    x86_64 currently).
  </li>
  <li>Feel free to delete your local copy once the files have been uploaded to sourceware.org.</li>
    </ul>
  </li>
  <li>
    <p>Announce via the <code>cygwin-announce</code> mailing list that the new
    package is available. See the <a href="#announcement">announce message
    template</a> later in this page.
    </p>
  </li>
  <li>
    <p>If you encounter any problems, email the <code>cygwin-apps</code> mailing list.</p>
  </li>
</ul>

<h2 class="cartouche" id="updating">Updating a package</h2>

<p>So you've got an updated package. You should already have upload privileges,
  and should be able to do the entire process yourself.</p>

<ul class="spaced">
  <li>
    You <em>must</em> increase the version or release number.  Reset the release
    number to 1 on a version increase.
  </li>
  <li>
    Follow the <a href="#acceptance">steps to upload</a>, as above.
  </li>
</ul>

<h2 class="cartouche" id="announcement">Composing an announcement mail</h2>

<p>
  <code>cygport announce</code> can help you compose and send an announcement mail,
  based on the following template.
</p>

<div class="sample-email">
Subject: foo-0.30.2-1<br/>
<br/>
The following packages have been uploaded to the Cygwin distribution:<br/>
<br/>
* foo 0.30.2-1<br/>
<br/>
(a couple of lines about what "foo" is)<br/>
(short changelog of important features or fixes; big emphasis for security fixes)<br/>
(paths or links to installed and online changelogs, with more details)<br/>
<br/>
</div>

<p>
  Once sent, your message will be reviewed by one of the cygwin-announce
  moderators and will be posted, when approved.
</p>

<h2 class="cartouche" id="history">Historical packaging methods</h2>

<p>
  The <code>cygport</code> framework improves
  on <a href="setup-packaging-historical.html">previous Cygwin build
  scripts</a>.
</p>

</div>
</body>
</html>
