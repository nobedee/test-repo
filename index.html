<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <title>Roffit Test</title>
 <style>
  * {
   box-sizing: border-box;
   position: relative;
  }
  nav {
   display: inline-block;
   position: fixed;
   top: 0px;
   left: 0px;
   width: 100%;
   max-height: 60px;
   padding: 0px 10px;
   background: black;
   color: white;
   z-index: 1;
  } 
  nav div, nav ul, nav ul li {
   display: inline-block;
   position: relative;
  } 
  nav div.test-switches {
   box-sizing: border-box;   
   top: -1px;
   height: 60px;
   margin: 0px;
   padding: 5px;
   background: gray;
  }
  nav div.test-switches label {
   display: inline-block;
   position: relative;
   top: -5px;   
   height: 60px;
   padding: 5% 25px;
   background: gray;
   cursor: pointer;
  }
  nav div.test-switches input {
   display: none;
  }
  nav div.test-switches label[data-check^="1"], 
  nav div.test-switches input[checked] + label {
   background: white;
   color: black;
   font-weight: bold;
   text-decoration: underline;
  }
  nav div.test-switches div.split-mark {
   top: -24px;
   height: 60px;
   width: 2px;
   border-right: 2px solid white;   
   color: white;
  }
  nav ul li {
   margin: 5px;
  }

  /* menu function */
  [data-status^="0"] + div {
   display: none;
  }
  [data-status^="1"] + div {
   display: initial;
  }
  nav ul li span {
   display: inline-block;
   top: -1px;
   margin-top: 0px;     
   margin-left: 50px;
   padding: 5px 15px;
   cursor: pointer;      
  }    
  nav ul li span + div {
   display: block;
   margin-right: 20px
  }  
  nav ul li div.dropdown {
   display: block;
   position: absolute;
   left: 40px;
   width: auto;
   margin-left:5px;
   padding: 2px 10px;   
	  padding-bottom: 15px;
   background: gray;
  }
  nav ul li div.dropdown div span {
   padding: 0px;
   margin-left: 10px;
  }
  nav ul li span:hover {
   text-decoration: underline;
   font-weight: bold;
   background: darkslategray;
  }
  nav ul li div.dropdown div span:hover {
	  padding: 0px 5px;
   background: gray;   
  }
  span.pageDrop + div.dropdown.nestedDropdown {	 
	  position: relative;   
	  width: 85%;
   max-height: 500px;
	  background: white;
	  color: black;	  
   overflow-y: scroll;   
   z-index: 1;
	}
  span.pageDrop + div.dropdown.nestedDropdown ul {
   width: 100%;
   left: 0px;
   margin: 0px;
   padding: 0px;
  }
  span.pageDrop + div.dropdown.nestedDropdown ul li {
   width: 110%;
   left: -12%;
   margin: 3px 0px;
   padding: 0px 5px;
  }
  span.pageDrop[data-nest-check^="0"] + div.dropdown.nestedDropdown {
   display: none;
  }
  span.pageDrop + div.dropdown.nestedDropdown ul li:hover {
   background: lightgray;
  }
  /* Document styling */
  body nav + * {
   margin-top: 100px;
   margin-left: 50px;
  }
  h1 {
   margin-left: 50px;
  }
  div#diffFiles, div#diffStats, div#runTimes {
   margin-left: 75px;
  }
 </style>
</head>
<body>
 <nav>
  <div class="test-switches">
   <input checked name="roffit-used" type="radio" id="roffit-source">
   <label for="roffit-source" data-check="1" data-source="source"
    onClick="setSource(this, this.dataset.source)">Source Roffit Output</label>
   
   <div class="split-mark">|</div>
   
   <input name="roffit-used" type="radio" id="roffit-pull">
   <label for="roffit-pull" data-check="0"  data-source="pull"
    onClick="setSource(this, this.dataset.source)">Pull Roffit Output</label>    
  </div>
  <div style="diplay:inline; height: 40px; width:3px; top:15px; margin: 0px 0px 0px 25px; padding: 0px; background:white;"></div>
  <ul id="navList">
   <li id="curl">
    <span onclick="
     changeNextElementDisplay(this, this.nextElementSibling);
     resetDropDowns(this, this.dataset.status);" data-status="0">Unique</span>
    <div class="dropdown" style="display:none">
     <div>
      <span class="pageDrop" data-nest-check="0" onclick="changeNextElementDisplay(this, this.nextElementSibling); resetDropDowns(this, this.dataset.nestCheck);">bare</span>
      <div class="dropdown nestedDropdown" style="display:none"></div>
     </div>
     <div>
      <span class="pageDrop" data-nest-check="0" onclick="changeNextElementDisplay(this, this.nextElementSibling); resetDropDowns(this, this.dataset.nestCheck);">standalone</span>
      <div class="dropdown nestedDropdown" style="display:none"></div>
     </div>
    </div>
   </li>
   <li id="err">
    <span onclick="
     changeNextElementDisplay(this, this.nextElementSibling);
     resetDropDowns(this, this.dataset.status);" data-status="0">Differences</span>
    <div class="dropdown" style="display:none">
     <div>
      <span class="pageDrop" data-nest-check="0" onclick="changeNextElementDisplay(this, this.nextElementSibling); resetDropDowns(this, this.dataset.nestCheck);">bare</span>
      <div class="dropdown nestedDropdown" style="display:none"></div>
     </div>
     <div>
      <span class="pageDrop" data-nest-check="0" onclick="changeNextElementDisplay(this, this.nextElementSibling); resetDropDowns(this, this.dataset.nestCheck);">standalone</span>
      <div class="dropdown nestedDropdown" style="display:none"></div>
     </div>
    </div>
   </li>
   <li id="gen">
    <span onclick="
     changeNextElementDisplay(this, this.nextElementSibling);
     resetDropDowns(this, this.dataset.status);" data-status="0">General</span>
    <div class="dropdown" style="display:none">
     <div>
      <span class="pageDrop" data-nest-check="0" onclick="changeNextElementDisplay(this, this.nextElementSibling); resetDropDowns(this, this.dataset.nestCheck);">bare</span>      
      <div class="dropdown nestedDropdown" style="display:none"></div>
     </div>
     <div>
      <span class="pageDrop" data-nest-check="0" onclick="changeNextElementDisplay(this, this.nextElementSibling); resetDropDowns(this, this.dataset.nestCheck);">standalone</span>
      
      <div class="dropdown nestedDropdown" style="display:none"></div>
     </div>
    </div>
   </li>   
  </ul>
 </nav> 
 
 <!-- Overview of differne diles by the numbers.-->
 <h1>Different File Statistics</h1><hr>
 <div id="diffStats"></div>
 <br>
 
 <!-- Compare run times. -->
 <h1>Source and Pull Run Times</h1><hr>
 <div id="runTimes"></div>
 <br>
 
 <!-- Output diff with files with differences  -->
 <h1>Different Files Compared</h1><hr>
 <div id="diffFiles"></div>
 <br>
 
 <!-- Link to js tools -->
 <script src="https://cdn.jsdelivr.net/gh/jhauga/general/reusableJavascriptFunctions.js"></script>
 <!--temp determine test -->
 <script>
  var test = 0;
	
	if (test == 1) {
	 let dd = document.getElementsByClassName("dropdown");
	 let ddLen = dd.length;
	 let i = 0;
	 while (i < ddLen) {
	  dd[i].style.display = "";
		if (dd[i].previousElementSibling.hasAttribute("data-status")) dd[i].removeAttribute("data-status");
		i++;
	 }
	} 
 </script>
 <!-- page scripts -->
 <script>
  // Global elements.
  var navList = document.getElementById("navList");
  var navListATags = navList.getElementsByTagName("a");
	 var dataCheck = document.querySelectorAll("[data-check]");
  var dataNestCheck;
  var toggleDataCheck = function(ind) { 
   if (typeof ind == "number") {
    dataCheck[ind].dataset.check = "0"; 
    dataCheck[ind].previousElementSibling.removeAttribute("checked"); 
   } else {
    if (ind == "a") {
     dataNestCheck[1].dataset.nestCheck = "0";
     dataNestCheck[1].dataset.showhide = "0";
    } else {
     dataNestCheck[0].dataset.nestCheck = "0";
     dataNestCheck[0].dataset.showhide = "0";
    }
   }
  };
  
	 var sourceIsSet = 0;
  function setSource(cur, rofSource) {
	  if (rofSource == undefined) rofSource = "source";
   let navListATagsLen = navListATags.length; let curHref;
   if (cur != undefined) {
    let checkStatus = cur.dataset.check;    
    if (cur.nextElementSibling == null) { toggleDataCheck(0); }
    else { toggleDataCheck(1); }
    
    if (checkStatus == "0") { 
     cur.dataset.check = "1"; 
     cur.previousElementSibling.setAttribute("checked", true);
    } 
     else { 
      cur.dataset.check = "0";
      cur.previousElementSibling.setAttribute("checked", true);
     }
   }
   for (let i = 0; i < navListATagsLen; i++) {
    curHref = navListATags[i].href;
    if (sourceIsSet == 0) {
       navListATags[i].href = curHref.replace("ROFFIT_USED", rofSource);
    } else {
     if (rofSource == "pull") {
      navListATags[i].href = curHref.replace("source", rofSource);
     } else {
      navListATags[i].href = curHref.replace("pull", rofSource);
     }
    }
   }
	 sourceIsSet = 1;
  }
	
  function resetDropDowns(cur, curStatus) {
   let curnestedDropdown = cur.nextElementSibling;
   let curData = cur.dataset;   
   let theCurStatus = curStatus;
   
   let theDropDowns = document.querySelectorAll("[data-status]");
   let theDropDownsLen = theDropDowns.length;
   // not a nested dropdown
   if (curnestedDropdown.className.indexOf("nestedDropdown") == -1) {
    dataNestCheck = document.querySelectorAll("[data-nest-check]");
    let dataNestCheckLen = dataNestCheck.length;
    for (let i = 0; i < dataNestCheckLen; i++) {
     dataNestCheck[i].dataset.nestCheck = "0";
    }
    for (let i = 0; i < theDropDownsLen; i++) {
     theDropDowns[i].dataset.status = 0;
     theDropDowns[i].nextElementSibling.style.display = "none";     
    }
    if (theCurStatus == 0) {
     cur.dataset.status = 1;
     cur.nextElementSibling.style.display = "";
    } else {
     cur.dataset.status = 0;
     cur.nextElementSibling.style.display = "none";
    }   
   } else { // is a nested dropdown
    let theParent = cur.parentElement;
    let theGrandparent = theParent.parentElement;
    dataNestCheck = theGrandparent.querySelectorAll("[data-nest-check]");
    if (theParent.nextElementSibling == null) {
     toggleDataCheck("b");
    } else {
     toggleDataCheck("a");
    }
    // Show the nested dropdown clicked.
    if (cur.dataset.showhide == "1") {
     cur.dataset.nestCheck = "1";
    } else {
     cur.dataset.nestCheck = "0";
    }
   }
  }
	
	// Output links.
	function makeLinks(file, ind) {	 
	 let curDropdown = document.getElementById(file);
	 let nestedDropdown = curDropdown.getElementsByClassName("nestedDropdown")[ind];
	 let xmlhttp = new XMLHttpRequest();
	 var iMakeLinks = function() {
    xmlhttp.onreadystatechange = function() {
     let curhref = this.responseText;
     let curhrefArr = curhref.split("\n");
     nestedDropdown.innerHTML = "<ul>";
     let i = 0;
     while (i < curhrefArr.length) {
		  if (ind == 1) {
			 if (curhrefArr[i+1]) {
       nestedDropdown.innerHTML += "<li><a target='_blank' href='" +
       curhrefArr[i+1] + "'>" +
       curhrefArr[i+1].substring(curhrefArr[i+1].lastIndexOf("/")+1, curhrefArr[i+1].indexOf("-")) +
       "</a></li>";
			 }
			 i+=2;		
			} else {
			 if (i%2 == 0) {
        nestedDropdown.innerHTML += "<li><a target='_blank' href='" +
        curhrefArr[i] + "'>" +
        curhrefArr[i].substring(curhrefArr[i].lastIndexOf("/")+1, curhrefArr[i].indexOf("-")) +
        "</a></li>";						
			  }
				i++;
			 }
     }
		 nestedDropdown.innerHTML += "</ul>";	
     };
		xmlhttp.open("GET", "support/menu-"+file+"-links.txt", true);
	  xmlhttp.send();
	 };	 
	 iMakeLinks();
	}
	makeLinks("curl",0); makeLinks("curl",1);
	makeLinks("err", 0); makeLinks("err", 1);
	makeLinks("gen", 0); makeLinks("gen", 1);
	// Set default roffit
	setTimeout(setSource, 500);
 </script>
 <!-- Output files with diff -->
 <script>
  var diffFiles = document.getElementById("diffFiles");
  var files, filesLen;
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
   if (this.readyState == 4 && this.status == 200) {
   let errList = this.responseText;
   let testreg = /tests/g;
   let htmlreg = /html/g;
   let roffreg = /ROFFIT_USED-/g;
   let htmlltreg = /</g;
   let htmlgtreg = />/g;
   let openh3reg = /&lt;h3&gt;/g; let closeh3reg = /&lt;\/h3&gt;/g;
   let errListTxt = errList.replace(testreg, "diff");
   errListTxt = errListTxt.replace(htmlreg, "txt");
   errListTxt = errListTxt.replace(roffreg, "");
   errListTxt = errListTxt.replace(htmlltreg, "&lt;");
   errListTxt = errListTxt.replace(htmlgtreg, "&gt;");
   errListTxt = errListTxt.replace(openh3reg, "<h3>");
   errListTxt = errListTxt.replace(closeh3reg, "</h3>");
   files = errListTxt.split("\n");	 
   filesLen = files.length;
   for (i in files) {
    diffFiles.innerHTML += files[i] + "<br>";; 
   }
   }
  };
  xmlhttp.open("GET", "diff/errs.txt", true);
  xmlhttp.send();
 
  // Output the stats for differnet files.
  var diffStats = document.getElementById("diffStats");
  xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
   if (this.readyState == 4 && this.status == 200) {
    // let diffStatText = this.responseText;
    diffStats.innerHTML = this.responseText;
   }
  };
  xmlhttp.open("GET", "support/diff-stats.txt", true);
  xmlhttp.send();
	
 var runTimes = document.getElementById("runTimes");
 xmlhttp = new XMLHttpRequest();
 xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
   //let runTimeText = this.responseText;
   runTimes.innerHTML = this.responseText;
  }
 };
 xmlhttp.open("GET", "support/run-times.txt", true);
 xmlhttp.send();
 
 // Lastely alert repo switch.
 var alertText = "The top left menu buttons toggle the html\n" +
                 "pages that were created with the repository\n" +
                 "that is higlighted in the menu. Pages will open in\n" +
                 "a new tab in browser.";
 setTimeout(function() {alert(alertText);}, 1000);
 </script>
</body>
</html>